!function(e){var t={};function a(s){if(t[s])return t[s].exports;var l=t[s]={i:s,l:!1,exports:{}};return e[s].call(l.exports,l,l.exports,a),l.l=!0,l.exports}a.m=e,a.c=t,a.d=function(e,t,s){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(a.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var l in e)a.d(s,l,function(t){return e[t]}.bind(null,l));return s},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=2)}([function(e,t){class a{constructor({vis:e,queryResponseField:t}){this.vis=e,this.name=t.name,this.view=t.view_label||"",this.label=t.field_group_variant||t.label_short||t.label,this.is_numeric=void 0!==t.is_numeric&&t.is_numeric,this.is_array=["list","number_list","location","tier"].includes(t.type),this.value_format=t.value_format?t.value_format:"",this.geo_type="",("location"===t.type||t.map_layer)&&(this.geo_type="location"===t.type?"location":t.map_layer.name),this.hide=!1,void 0!==this.vis.config["hide|"+this.name]&&this.vis.config["hide|"+this.name]&&(this.hide=!0),this.style="";var a=this.vis.config["style|"+this.name];void 0!==a&&("hide"===a?this.hide=!0:this.style=a),this.heading="",this.short_name="",this.unit="",void 0!==t.tags&&t.tags.forEach(e=>{var t=e.split(":");if("vis-tools"===t[0])switch(t[1]){case"heading":this.heading=t[2];break;case"short_name":this.short_name=t[2];break;case"unit":this.unit=t[2];break;case"style":this.style=t[2]}})}}class s{constructor({keys:e,values:t,types:a=[]}){if(e.length===t.length){this.keys=e,this.values=t,this.types=a;var s=[],l=[];this.values.forEach((e,t)=>{this.types[t]=void 0!==a[t]?a[t]:"line_item","line_item"===this.types[t]?(s.push(e),l.push(e)):"subtotal"===this.types[t]&&l.push(e)}),this.min_for_display=Math.min(...l),this.max_for_display=Math.max(...l),this.min=Math.min(...s),this.max=Math.max(...s),this.sum=s.reduce((e,t)=>e+t,0),this.count=s.length,this.avg=s.length>0?this.sum/s.length:null}else console.log("Could not construct series, arrays were of different length.")}}t.newArray=function(e,t){for(var a=[],s=0;s<e;s++)a.push(t);return a},t.ModelDimension=class extends a{constructor({vis:e,queryResponseField:t}){super({vis:e,queryResponseField:t}),this.type="dimension",this.align="left"}},t.ModelPivot=class extends a{constructor({vis:e,queryResponseField:t}){super({vis:e,queryResponseField:t}),this.type="pivot",this.align="center"}},t.ModelMeasure=class extends a{constructor({vis:e,queryResponseField:t,can_pivot:a}){super({vis:e,queryResponseField:t}),this.type="measure",this.align="right",this.is_table_calculation=void 0!==t.is_table_calculation&&t.is_table_calculation,this.calculation_type=t.type,this.is_turtle=void 0!==t.is_turtle&&t.is_turtle,this.can_pivot=a}},t.CellSeries=class{constructor({column:e,row:t,sort_value:a,series:l}){this.column=e,this.row=t,this.sort_value=a,this.series=new s(l)}toString(){var e="";return this.series.keys.forEach((t,a)=>{e+=t+":";var s=""===this.column.modelField.value_format?this.series.values[a].toString():SSF.format(this.column.modelField.value_format,this.series.values[a]);e+=s+" "}),e}},t.ColumnSeries=class{constructor({column:e,is_numeric:t,series:a}){this.column=e,this.is_numeric=t,this.series=new s(a)}},t.HeaderCell=class{constructor({column:e,type:t,label:a=null,align:s="",cell_style:l=[],modelField:i={name:"",label:"",view:""},pivotData:r={}}={column:e,type:t,label:a,align:s,cell_style:l,modelField:i,pivotData:r}){this.id=[e.id,t].join("."),this.column=e,this.type=t,this.colspan=1,this.rowspan=1,this.headerRow=!0,this.cell_style=["headerCell"].concat(l),this.label=a,this.align=s||(this.column.modelField.is_numeric?"right":"left"),this.modelField=i,this.pivotData=r,i.type&&this.cell_style.push(i.type),i.is_table_calculation&&this.cell_style.push("calculation")}},t.DataCell=class{constructor({value:e,rendered:t=null,html:a=null,links:s=[],cell_style:l=[],align:i="right",rowspan:r=1,colspan:n=1,rowid:o="",colid:d=""}={}){this.value=e,this.rendered=t,this.html=a,this.links=s,this.cell_style=["rowCell"].concat(l),this.align=i,this.rowspan=r,this.colspan=n,this.colid=d,this.rowid=o,this.id=d&&o?[d,o].join("."):null,null===this.value&&"∞"!==this.rendered&&(this.rendered="∅")}},t.Row=class{constructor(e="line_item"){this.id="",this.hide=!1,this.type=e,this.sort=[],this.data={}}},t.Column=class{constructor(e,t,a){this.id=e,this.vis=t,this.modelField=a,this.transposed=!1,this.idx=0,this.pos=0,this.levels=[],this.pivot_key="",this.unit=a.unit||"",this.hide=a.hide||!1,this.isVariance=!1,this.variance_type=null,this.pivoted=!1,this.isRowTotal=!1,this.super=!1,this.subtotal=!1,this.subtotal_data={},this.series=null,this.sort=[],this.colspans=[]}getHeaderCellLabel(e){var t=this.levels[e];if(null!==t.label)var a=t.label;else{a=t.modelField.label;var s=this.vis.config["heading|"+t.modelField.name],l=this.vis.config["label|"+t.modelField.name];if("heading"===t.type)return a=void 0!==s&&s||t.modelField.heading;"field"===t.type&&(a=this.vis.useShortName&&t.modelField.short_name||t.modelField.label,void 0!==l&&l!==this.modelField.label&&(a=l||a),this.isVariance&&(a=this.vis.groupVarianceColumns?2===this.vis.pivot_values.length?"absolute"===this.variance_type?a+" #":a+" %":"absolute"===this.variance_type?a+" Var #":a+" Var %":"absolute"===this.variance_type?"Var #":"Var %"),void 0!==this.vis.useViewName&&this.vis.useViewName&&(a=[this.modelField.view,a].join(" "))),"pivot"===t.type&&this.isVariance&&this.vis.groupVarianceColumns&&(a=2===this.vis.pivot_values.length?"Variance":"Var "+a)}return a}getHeaderCellLabelByType(e){for(var t=0;t<this.vis.headers.length;t++)if(e===this.vis.headers[t].type)return this.getHeaderCellLabel(t);return null}setHeaderCellLabels(){this.levels.forEach((e,t)=>{e.label=null===e.label?this.getHeaderCellLabel(t):e.label})}getHeaderData(){var e={};return this.modelField.vis.headers.forEach((t,a)=>{e[t.type]=this.levels[a]}),e}}},function(e,t,a){var s={};!function(e){function t(e){for(var t="",a=e.length-1;a>=0;)t+=e.charAt(a--);return t}function a(e,t){for(var a="";a.length<t;)a+=e;return a}function s(e,t){var s=""+e;return s.length>=t?s:a("0",t-s.length)+s}function l(e,t){var s=""+e;return s.length>=t?s:a(" ",t-s.length)+s}function i(e,t){var s=""+e;return s.length>=t?s:s+a(" ",t-s.length)}e.version="0.11.0";var r=Math.pow(2,32);function n(e,t){return e>r||e<-r?function(e,t){var s=""+Math.round(e);return s.length>=t?s:a("0",t-s.length)+s}(e,t):function(e,t){var s=""+e;return s.length>=t?s:a("0",t-s.length)+s}(Math.round(e),t)}function o(e,t){return t=t||0,e.length>=7+t&&103==(32|e.charCodeAt(t))&&101==(32|e.charCodeAt(t+1))&&110==(32|e.charCodeAt(t+2))&&101==(32|e.charCodeAt(t+3))&&114==(32|e.charCodeAt(t+4))&&97==(32|e.charCodeAt(t+5))&&108==(32|e.charCodeAt(t+6))}var d=[["Sun","Sunday"],["Mon","Monday"],["Tue","Tuesday"],["Wed","Wednesday"],["Thu","Thursday"],["Fri","Friday"],["Sat","Saturday"]],h=[["J","Jan","January"],["F","Feb","February"],["M","Mar","March"],["A","Apr","April"],["M","May","May"],["J","Jun","June"],["J","Jul","July"],["A","Aug","August"],["S","Sep","September"],["O","Oct","October"],["N","Nov","November"],["D","Dec","December"]];function u(e){e[0]="General",e[1]="0",e[2]="0.00",e[3]="#,##0",e[4]="#,##0.00",e[9]="0%",e[10]="0.00%",e[11]="0.00E+00",e[12]="# ?/?",e[13]="# ??/??",e[14]="m/d/yy",e[15]="d-mmm-yy",e[16]="d-mmm",e[17]="mmm-yy",e[18]="h:mm AM/PM",e[19]="h:mm:ss AM/PM",e[20]="h:mm",e[21]="h:mm:ss",e[22]="m/d/yy h:mm",e[37]="#,##0 ;(#,##0)",e[38]="#,##0 ;[Red](#,##0)",e[39]="#,##0.00;(#,##0.00)",e[40]="#,##0.00;[Red](#,##0.00)",e[45]="mm:ss",e[46]="[h]:mm:ss",e[47]="mmss.0",e[48]="##0.0E+0",e[49]="@",e[56]='"上午/下午 "hh"時"mm"分"ss"秒 "',e[65535]="General"}var c={};function m(e,t,a){for(var s=e<0?-1:1,l=e*s,i=0,r=1,n=0,o=1,d=0,h=0,u=Math.floor(l);d<t&&(n=(u=Math.floor(l))*r+i,h=u*d+o,!(l-u<5e-8));)l=1/(l-u),i=r,r=n,o=d,d=h;if(h>t&&(d>t?(h=o,n=i):(h=d,n=r)),!a)return[0,s*n,h];var c=Math.floor(s*n/h);return[c,s*n-c*h,h]}function p(e,t,a){if(e>2958465||e<0)return null;var s=0|e,l=Math.floor(86400*(e-s)),i=0,r=[],n={D:s,T:l,u:86400*(e-s)-l,y:0,m:0,d:0,H:0,M:0,S:0,q:0};if(Math.abs(n.u)<1e-6&&(n.u=0),t&&t.date1904&&(s+=1462),n.u>.9999&&(n.u=0,86400==++l&&(n.T=l=0,++s,++n.D)),60===s)r=a?[1317,10,29]:[1900,2,29],i=3;else if(0===s)r=a?[1317,8,29]:[1900,1,0],i=6;else{s>60&&--s;var o=new Date(1900,0,1);o.setDate(o.getDate()+s-1),r=[o.getFullYear(),o.getMonth()+1,o.getDate()],i=o.getDay(),s<60&&(i=(i+6)%7),a&&(i=0)}return n.y=r[0],n.m=r[1],n.d=r[2],n.S=l%60,l=Math.floor(l/60),n.M=l%60,l=Math.floor(l/60),n.H=l,n.q=i,n}u(c),e.parse_date_code=p;var f=new Date(1899,11,31,0,0,0),v=f.getTime(),g=new Date(1900,2,1,0,0,0);function b(e,t){var a=e.getTime();return t?a-=1262304e5:e>=g&&(a+=864e5),(a-(v+6e4*(e.getTimezoneOffset()-f.getTimezoneOffset())))/864e5}e._general_int=function(e){return e.toString(10)};var y=function(){var e=/\.(\d*[1-9])0+$/,t=/\.0*$/,a=/\.(\d*[1-9])0+/,s=/\.0*[Ee]/,l=/(E[+-])(\d)$/;function i(a){return a.indexOf(".")>-1?a.replace(t,"").replace(e,".$1"):a}return function(t){var r,n=Math.floor(Math.log(Math.abs(t))*Math.LOG10E);return r=n>=-4&&n<=-1?t.toPrecision(10+n):Math.abs(n)<=9?function(e){var t=e<0?12:11,a=i(e.toFixed(12));return a.length<=t||(a=e.toPrecision(10)).length<=t?a:e.toExponential(5)}(t):10===n?t.toFixed(10).substr(0,12):function(t){var a=t.toFixed(11).replace(e,".$1");return a.length>(t<0?12:11)&&(a=t.toPrecision(6)),a}(t),i(function(e){for(var t=0;t!=e.length;++t)if(101==(32|e.charCodeAt(t)))return e.replace(a,".$1").replace(s,"E").replace("e","E").replace(l,"$10$2");return e}(r))}}();function _(e,t){switch(typeof e){case"string":return e;case"boolean":return e?"TRUE":"FALSE";case"number":return(0|e)===e?e.toString(10):y(e);case"undefined":return"";case"object":if(null==e)return"";if(e instanceof Date)return T(14,b(e,t&&t.date1904),t)}throw new Error("unsupported value in General format: "+e)}function w(e,t,a,l){var i,r="",n=0,o=0,u=a.y,c=0;switch(e){case 98:u=a.y+543;case 121:switch(t.length){case 1:case 2:i=u%100,c=2;break;default:i=u%1e4,c=4}break;case 109:switch(t.length){case 1:case 2:i=a.m,c=t.length;break;case 3:return h[a.m-1][1];case 5:return h[a.m-1][0];default:return h[a.m-1][2]}break;case 100:switch(t.length){case 1:case 2:i=a.d,c=t.length;break;case 3:return d[a.q][0];default:return d[a.q][1]}break;case 104:switch(t.length){case 1:case 2:i=1+(a.H+11)%12,c=t.length;break;default:throw"bad hour format: "+t}break;case 72:switch(t.length){case 1:case 2:i=a.H,c=t.length;break;default:throw"bad hour format: "+t}break;case 77:switch(t.length){case 1:case 2:i=a.M,c=t.length;break;default:throw"bad minute format: "+t}break;case 115:if("s"!=t&&"ss"!=t&&".0"!=t&&".00"!=t&&".000"!=t)throw"bad second format: "+t;return 0!==a.u||"s"!=t&&"ss"!=t?(o=l>=2?3===l?1e3:100:1===l?10:1,(n=Math.round(o*(a.S+a.u)))>=60*o&&(n=0),"s"===t?0===n?"0":""+n/o:(r=s(n,2+l),"ss"===t?r.substr(0,2):"."+r.substr(2,t.length-1))):s(a.S,t.length);case 90:switch(t){case"[h]":case"[hh]":i=24*a.D+a.H;break;case"[m]":case"[mm]":i=60*(24*a.D+a.H)+a.M;break;case"[s]":case"[ss]":i=60*(60*(24*a.D+a.H)+a.M)+Math.round(a.S+a.u);break;default:throw"bad abstime format: "+t}c=3===t.length?1:2;break;case 101:i=u,c=1}return c>0?s(i,c):""}function $(e){if(e.length<=3)return e;for(var t=e.length%3,a=e.substr(0,t);t!=e.length;t+=3)a+=(a.length>0?",":"")+e.substr(t,3);return a}e._general_num=y,e._general=_;var F=function(){var e=/%/g;var r=/# (\?+)( ?)\/( ?)(\d+)/;var o=/^#*0*\.([0#]+)/,d=/\).*[0#]/,h=/\(###\) ###\\?-####/;function u(e){for(var t,a="",s=0;s!=e.length;++s)switch(t=e.charCodeAt(s)){case 35:break;case 63:a+=" ";break;case 48:a+="0";break;default:a+=String.fromCharCode(t)}return a}function c(e,t){var a=Math.pow(10,t);return""+Math.round(e*a)/a}function p(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?0:Math.round((e-Math.floor(e))*Math.pow(10,t))}function f(v,g,b){if(40===v.charCodeAt(0)&&!g.match(d)){var y=g.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return b>=0?f("n",y,b):"("+f("n",y,-b)+")"}if(44===g.charCodeAt(g.length-1))return function(e,t,a){for(var s=t.length-1;44===t.charCodeAt(s-1);)--s;return F(e,t.substr(0,s),a/Math.pow(10,3*(t.length-s)))}(v,g,b);if(-1!==g.indexOf("%"))return function(t,s,l){var i=s.replace(e,""),r=s.length-i.length;return F(t,i,l*Math.pow(10,2*r))+a("%",r)}(v,g,b);if(-1!==g.indexOf("E"))return function e(t,a){var s,l=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==a)return"0.0E+0";if(a<0)return"-"+e(t,-a);var i=t.indexOf(".");-1===i&&(i=t.indexOf("E"));var r=Math.floor(Math.log(a)*Math.LOG10E)%i;if(r<0&&(r+=i),-1===(s=(a/Math.pow(10,r)).toPrecision(l+1+(i+r)%i)).indexOf("e")){var n=Math.floor(Math.log(a)*Math.LOG10E);for(-1===s.indexOf(".")?s=s.charAt(0)+"."+s.substr(1)+"E+"+(n-s.length+r):s+="E+"+(n-r);"0."===s.substr(0,2);)s=(s=s.charAt(0)+s.substr(2,i)+"."+s.substr(2+i)).replace(/^0+([1-9])/,"$1").replace(/^0+\./,"0.");s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,a,s){return t+a+s.substr(0,(i+r)%i)+"."+s.substr(r)+"E"}))}else s=a.toExponential(l);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}(g,b);if(36===g.charCodeAt(0))return"$"+f(v,g.substr(" "==g.charAt(1)?2:1),b);var _,w,C,E,M=Math.abs(b),k=b<0?"-":"";if(g.match(/^00+$/))return k+n(M,g.length);if(g.match(/^[#?]+$/))return"0"===(_=n(b,0))&&(_=""),_.length>g.length?_:u(g.substr(0,g.length-_.length))+_;if(w=g.match(r))return function(e,t,i){var r=parseInt(e[4],10),n=Math.round(t*r),o=Math.floor(n/r),d=n-o*r,h=r;return i+(0===o?"":""+o)+" "+(0===d?a(" ",e[1].length+1+e[4].length):l(d,e[1].length)+e[2]+"/"+e[3]+s(h,e[4].length))}(w,M,k);if(g.match(/^#+0+$/))return k+n(M,g.length-g.indexOf("0"));if(w=g.match(o))return _=c(b,w[1].length).replace(/^([^\.]+)$/,"$1."+u(w[1])).replace(/\.$/,"."+u(w[1])).replace(/\.(\d*)$/,(function(e,t){return"."+t+a("0",u(w[1]).length-t.length)})),-1!==g.indexOf("0.")?_:_.replace(/^0\./,".");if(g=g.replace(/^#+([0.])/,"$1"),w=g.match(/^(0*)\.(#*)$/))return k+c(M,w[2].length).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,w[1].length?"0.":".");if(w=g.match(/^#{1,3},##0(\.?)$/))return k+$(n(M,0));if(w=g.match(/^#,##0\.([#0]*0)$/))return b<0?"-"+f(v,g,-b):$(""+(Math.floor(b)+function(e,t){return t<(""+Math.round((e-Math.floor(e))*Math.pow(10,t))).length?1:0}(b,w[1].length)))+"."+s(p(b,w[1].length),w[1].length);if(w=g.match(/^#,#*,#0/))return f(v,g.replace(/^#,#*,/,""),b);if(w=g.match(/^([0#]+)(\\?-([0#]+))+$/))return _=t(f(v,g.replace(/[\\-]/g,""),b)),C=0,t(t(g.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return C<_.length?_.charAt(C++):"0"===e?"0":""})));if(g.match(h))return"("+(_=f(v,"##########",b)).substr(0,3)+") "+_.substr(3,3)+"-"+_.substr(6);var x="";if(w=g.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return C=Math.min(w[4].length,7),E=m(M,Math.pow(10,C)-1,!1),_=""+k," "==(x=F("n",w[1],E[1])).charAt(x.length-1)&&(x=x.substr(0,x.length-1)+"0"),_+=x+w[2]+"/"+w[3],(x=i(E[2],C)).length<w[4].length&&(x=u(w[4].substr(w[4].length-x.length))+x),_+=x;if(w=g.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return C=Math.min(Math.max(w[1].length,w[4].length),7),k+((E=m(M,Math.pow(10,C)-1,!0))[0]||(E[1]?"":"0"))+" "+(E[1]?l(E[1],C)+w[2]+"/"+w[3]+i(E[2],C):a(" ",2*C+1+w[2].length+w[3].length));if(w=g.match(/^[#0?]+$/))return _=n(b,0),g.length<=_.length?_:u(g.substr(0,g.length-_.length))+_;if(w=g.match(/^([#0?]+)\.([#0]+)$/)){_=""+b.toFixed(Math.min(w[2].length,10)).replace(/([^0])0+$/,"$1"),C=_.indexOf(".");var S=g.indexOf(".")-C,O=g.length-_.length-S;return u(g.substr(0,S)+_+g.substr(g.length-O))}if(w=g.match(/^00,000\.([#0]*0)$/))return C=p(b,w[1].length),b<0?"-"+f(v,g,-b):$(function(e){return e<2147483647&&e>-2147483648?""+(e>=0?0|e:e-1|0):""+Math.floor(e)}(b)).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?s(0,3-e.length):"")+e}))+"."+s(C,w[1].length);switch(g){case"###,##0.00":return f(v,"#,##0.00",b);case"###,###":case"##,###":case"#,###":var T=$(n(M,0));return"0"!==T?k+T:"";case"###,###.00":return f(v,"###,##0.00",b).replace(/^0\./,".");case"#,###.00":return f(v,"#,##0.00",b).replace(/^0\./,".")}throw new Error("unsupported format |"+g+"|")}function v(n,c,p){if(40===n.charCodeAt(0)&&!c.match(d)){var f=c.replace(/\( */,"").replace(/ \)/,"").replace(/\)/,"");return p>=0?v("n",f,p):"("+v("n",f,-p)+")"}if(44===c.charCodeAt(c.length-1))return function(e,t,a){for(var s=t.length-1;44===t.charCodeAt(s-1);)--s;return F(e,t.substr(0,s),a/Math.pow(10,3*(t.length-s)))}(n,c,p);if(-1!==c.indexOf("%"))return function(t,s,l){var i=s.replace(e,""),r=s.length-i.length;return F(t,i,l*Math.pow(10,2*r))+a("%",r)}(n,c,p);if(-1!==c.indexOf("E"))return function e(t,a){var s,l=t.indexOf("E")-t.indexOf(".")-1;if(t.match(/^#+0.0E\+0$/)){if(0==a)return"0.0E+0";if(a<0)return"-"+e(t,-a);var i=t.indexOf(".");-1===i&&(i=t.indexOf("E"));var r=Math.floor(Math.log(a)*Math.LOG10E)%i;if(r<0&&(r+=i),!(s=(a/Math.pow(10,r)).toPrecision(l+1+(i+r)%i)).match(/[Ee]/)){var n=Math.floor(Math.log(a)*Math.LOG10E);-1===s.indexOf(".")?s=s.charAt(0)+"."+s.substr(1)+"E+"+(n-s.length+r):s+="E+"+(n-r),s=s.replace(/\+-/,"-")}s=s.replace(/^([+-]?)(\d*)\.(\d*)[Ee]/,(function(e,t,a,s){return t+a+s.substr(0,(i+r)%i)+"."+s.substr(r)+"E"}))}else s=a.toExponential(l);return t.match(/E\+00$/)&&s.match(/e[+-]\d$/)&&(s=s.substr(0,s.length-1)+"0"+s.charAt(s.length-1)),t.match(/E\-/)&&s.match(/e\+/)&&(s=s.replace(/e\+/,"e")),s.replace("e","E")}(c,p);if(36===c.charCodeAt(0))return"$"+v(n,c.substr(" "==c.charAt(1)?2:1),p);var g,b,y,_,w=Math.abs(p),C=p<0?"-":"";if(c.match(/^00+$/))return C+s(w,c.length);if(c.match(/^[#?]+$/))return g=""+p,0===p&&(g=""),g.length>c.length?g:u(c.substr(0,c.length-g.length))+g;if(b=c.match(r))return function(e,t,s){return s+(0===t?"":""+t)+a(" ",e[1].length+2+e[4].length)}(b,w,C);if(c.match(/^#+0+$/))return C+s(w,c.length-c.indexOf("0"));if(b=c.match(o))return g=(g=(""+p).replace(/^([^\.]+)$/,"$1."+u(b[1])).replace(/\.$/,"."+u(b[1]))).replace(/\.(\d*)$/,(function(e,t){return"."+t+a("0",u(b[1]).length-t.length)})),-1!==c.indexOf("0.")?g:g.replace(/^0\./,".");if(c=c.replace(/^#+([0.])/,"$1"),b=c.match(/^(0*)\.(#*)$/))return C+(""+w).replace(/\.(\d*[1-9])0*$/,".$1").replace(/^(-?\d*)$/,"$1.").replace(/^0\./,b[1].length?"0.":".");if(b=c.match(/^#{1,3},##0(\.?)$/))return C+$(""+w);if(b=c.match(/^#,##0\.([#0]*0)$/))return p<0?"-"+v(n,c,-p):$(""+p)+"."+a("0",b[1].length);if(b=c.match(/^#,#*,#0/))return v(n,c.replace(/^#,#*,/,""),p);if(b=c.match(/^([0#]+)(\\?-([0#]+))+$/))return g=t(v(n,c.replace(/[\\-]/g,""),p)),y=0,t(t(c.replace(/\\/g,"")).replace(/[0#]/g,(function(e){return y<g.length?g.charAt(y++):"0"===e?"0":""})));if(c.match(h))return"("+(g=v(n,"##########",p)).substr(0,3)+") "+g.substr(3,3)+"-"+g.substr(6);var E="";if(b=c.match(/^([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(b[4].length,7),_=m(w,Math.pow(10,y)-1,!1),g=""+C," "==(E=F("n",b[1],_[1])).charAt(E.length-1)&&(E=E.substr(0,E.length-1)+"0"),g+=E+b[2]+"/"+b[3],(E=i(_[2],y)).length<b[4].length&&(E=u(b[4].substr(b[4].length-E.length))+E),g+=E;if(b=c.match(/^# ([#0?]+)( ?)\/( ?)([#0?]+)/))return y=Math.min(Math.max(b[1].length,b[4].length),7),C+((_=m(w,Math.pow(10,y)-1,!0))[0]||(_[1]?"":"0"))+" "+(_[1]?l(_[1],y)+b[2]+"/"+b[3]+i(_[2],y):a(" ",2*y+1+b[2].length+b[3].length));if(b=c.match(/^[#0?]+$/))return g=""+p,c.length<=g.length?g:u(c.substr(0,c.length-g.length))+g;if(b=c.match(/^([#0]+)\.([#0]+)$/)){g=""+p.toFixed(Math.min(b[2].length,10)).replace(/([^0])0+$/,"$1"),y=g.indexOf(".");var M=c.indexOf(".")-y,k=c.length-g.length-M;return u(c.substr(0,M)+g+c.substr(c.length-k))}if(b=c.match(/^00,000\.([#0]*0)$/))return p<0?"-"+v(n,c,-p):$(""+p).replace(/^\d,\d{3}$/,"0$&").replace(/^\d*$/,(function(e){return"00,"+(e.length<3?s(0,3-e.length):"")+e}))+"."+s(0,b[1].length);switch(c){case"###,###":case"##,###":case"#,###":var x=$(""+w);return"0"!==x?C+x:"";default:if(c.match(/\.[0#?]*$/))return v(n,c.slice(0,c.lastIndexOf(".")),p)+u(c.slice(c.lastIndexOf(".")))}throw new Error("unsupported format |"+c+"|")}return function(e,t,a){return(0|a)===a?v(e,t,a):f(e,t,a)}}();function C(e){for(var t=[],a=!1,s=0,l=0;s<e.length;++s)switch(e.charCodeAt(s)){case 34:a=!a;break;case 95:case 42:case 92:++s;break;case 59:t[t.length]=e.substr(l,s-l),l=s+1}if(t[t.length]=e.substr(l),!0===a)throw new Error("Format |"+e+"| unterminated string ");return t}e._split=C;var E=/\[[HhMmSs]*\]/;function M(e){for(var t=0,a="",s="";t<e.length;)switch(a=e.charAt(t)){case"G":o(e,t)&&(t+=6),t++;break;case'"':for(;34!==e.charCodeAt(++t)&&t<e.length;);++t;break;case"\\":case"_":t+=2;break;case"@":++t;break;case"B":case"b":if("1"===e.charAt(t+1)||"2"===e.charAt(t+1))return!0;case"M":case"D":case"Y":case"H":case"S":case"E":case"m":case"d":case"y":case"h":case"s":case"e":case"g":return!0;case"A":case"a":if("A/P"===e.substr(t,3).toUpperCase())return!0;if("AM/PM"===e.substr(t,5).toUpperCase())return!0;++t;break;case"[":for(s=a;"]"!==e.charAt(t++)&&t<e.length;)s+=e.charAt(t);if(s.match(E))return!0;break;case".":case"0":case"#":for(;t<e.length&&("0#?.,E+-%".indexOf(a=e.charAt(++t))>-1||"\\"==a&&"-"==e.charAt(t+1)&&"0#".indexOf(e.charAt(t+2))>-1););break;case"?":for(;e.charAt(++t)===a;);break;case"*":++t," "!=e.charAt(t)&&"*"!=e.charAt(t)||++t;break;case"(":case")":++t;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(;t<e.length&&"0123456789".indexOf(e.charAt(++t))>-1;);break;case" ":default:++t}return!1}function k(e,t,a,s){for(var l,i,r,n=[],d="",h=0,u="",c="t",m="H";h<e.length;)switch(u=e.charAt(h)){case"G":if(!o(e,h))throw new Error("unrecognized character "+u+" in "+e);n[n.length]={t:"G",v:"General"},h+=7;break;case'"':for(d="";34!==(r=e.charCodeAt(++h))&&h<e.length;)d+=String.fromCharCode(r);n[n.length]={t:"t",v:d},++h;break;case"\\":var f=e.charAt(++h),v="("===f||")"===f?f:"t";n[n.length]={t:v,v:f},++h;break;case"_":n[n.length]={t:"t",v:" "},h+=2;break;case"@":n[n.length]={t:"T",v:t},++h;break;case"B":case"b":if("1"===e.charAt(h+1)||"2"===e.charAt(h+1)){if(null==l&&null==(l=p(t,a,"2"===e.charAt(h+1))))return"";n[n.length]={t:"X",v:e.substr(h,2)},c=u,h+=2;break}case"M":case"D":case"Y":case"H":case"S":case"E":u=u.toLowerCase();case"m":case"d":case"y":case"h":case"s":case"e":case"g":if(t<0)return"";if(null==l&&null==(l=p(t,a)))return"";for(d=u;++h<e.length&&e.charAt(h).toLowerCase()===u;)d+=u;"m"===u&&"h"===c.toLowerCase()&&(u="M"),"h"===u&&(u=m),n[n.length]={t:u,v:d},c=u;break;case"A":case"a":var g={t:u,v:u};if(null==l&&(l=p(t,a)),"A/P"===e.substr(h,3).toUpperCase()?(null!=l&&(g.v=l.H>=12?"P":"A"),g.t="T",m="h",h+=3):"AM/PM"===e.substr(h,5).toUpperCase()?(null!=l&&(g.v=l.H>=12?"PM":"AM"),g.t="T",h+=5,m="h"):(g.t="t",++h),null==l&&"T"===g.t)return"";n[n.length]=g,c=u;break;case"[":for(d=u;"]"!==e.charAt(h++)&&h<e.length;)d+=e.charAt(h);if("]"!==d.slice(-1))throw'unterminated "[" block: |'+d+"|";if(d.match(E)){if(null==l&&null==(l=p(t,a)))return"";n[n.length]={t:"Z",v:d.toLowerCase()},c=d.charAt(1)}else d.indexOf("$")>-1&&(d=(d.match(/\$([^-\[\]]*)/)||[])[1]||"$",M(e)||(n[n.length]={t:"t",v:d}));break;case".":if(null!=l){for(d=u;++h<e.length&&"0"===(u=e.charAt(h));)d+=u;n[n.length]={t:"s",v:d};break}case"0":case"#":for(d=u;++h<e.length&&"0#?.,E+-%".indexOf(u=e.charAt(h))>-1;)d+=u;n[n.length]={t:"n",v:d};break;case"?":for(d=u;e.charAt(++h)===u;)d+=u;n[n.length]={t:u,v:d},c=u;break;case"*":++h," "!=e.charAt(h)&&"*"!=e.charAt(h)||++h;break;case"(":case")":n[n.length]={t:1===s?"t":u,v:u},++h;break;case"1":case"2":case"3":case"4":case"5":case"6":case"7":case"8":case"9":for(d=u;h<e.length&&"0123456789".indexOf(e.charAt(++h))>-1;)d+=e.charAt(h);n[n.length]={t:"D",v:d};break;case" ":n[n.length]={t:u,v:u},++h;break;case"$":n[n.length]={t:"t",v:"$"},++h;break;default:if(-1===",$-+/():!^&'~{}<>=€acfijklopqrtuvwxzP".indexOf(u))throw new Error("unrecognized character "+u+" in "+e);n[n.length]={t:"t",v:u},++h}var b,y=0,$=0;for(h=n.length-1,c="t";h>=0;--h)switch(n[h].t){case"h":case"H":n[h].t=m,c="h",y<1&&(y=1);break;case"s":(b=n[h].v.match(/\.0+$/))&&($=Math.max($,b[0].length-1)),y<3&&(y=3);case"d":case"y":case"M":case"e":c=n[h].t;break;case"m":"s"===c&&(n[h].t="M",y<2&&(y=2));break;case"X":break;case"Z":y<1&&n[h].v.match(/[Hh]/)&&(y=1),y<2&&n[h].v.match(/[Mm]/)&&(y=2),y<3&&n[h].v.match(/[Ss]/)&&(y=3)}switch(y){case 0:break;case 1:l.u>=.5&&(l.u=0,++l.S),l.S>=60&&(l.S=0,++l.M),l.M>=60&&(l.M=0,++l.H);break;case 2:l.u>=.5&&(l.u=0,++l.S),l.S>=60&&(l.S=0,++l.M)}var C,k="";for(h=0;h<n.length;++h)switch(n[h].t){case"t":case"T":case" ":case"D":break;case"X":n[h].v="",n[h].t=";";break;case"d":case"m":case"y":case"h":case"H":case"M":case"s":case"e":case"b":case"Z":n[h].v=w(n[h].t.charCodeAt(0),n[h].v,l,$),n[h].t="t";break;case"n":case"?":for(C=h+1;null!=n[C]&&("?"===(u=n[C].t)||"D"===u||(" "===u||"t"===u)&&null!=n[C+1]&&("?"===n[C+1].t||"t"===n[C+1].t&&"/"===n[C+1].v)||"("===n[h].t&&(" "===u||"n"===u||")"===u)||"t"===u&&("/"===n[C].v||" "===n[C].v&&null!=n[C+1]&&"?"==n[C+1].t));)n[h].v+=n[C].v,n[C]={v:"",t:";"},++C;k+=n[h].v,h=C-1;break;case"G":n[h].t="t",n[h].v=_(t,a)}var x,S,O="";if(k.length>0){40==k.charCodeAt(0)?(x=t<0&&45===k.charCodeAt(0)?-t:t,S=F("n",k,x)):(S=F("n",k,x=t<0&&s>1?-t:t),x<0&&n[0]&&"t"==n[0].t&&(S=S.substr(1),n[0].v="-"+n[0].v)),C=S.length-1;var T=n.length;for(h=0;h<n.length;++h)if(null!=n[h]&&"t"!=n[h].t&&n[h].v.indexOf(".")>-1){T=h;break}var A=n.length;if(T===n.length&&-1===S.indexOf("E")){for(h=n.length-1;h>=0;--h)null!=n[h]&&-1!=="n?".indexOf(n[h].t)&&(C>=n[h].v.length-1?(C-=n[h].v.length,n[h].v=S.substr(C+1,n[h].v.length)):C<0?n[h].v="":(n[h].v=S.substr(0,C+1),C=-1),n[h].t="t",A=h);C>=0&&A<n.length&&(n[A].v=S.substr(0,C+1)+n[A].v)}else if(T!==n.length&&-1===S.indexOf("E")){for(C=S.indexOf(".")-1,h=T;h>=0;--h)if(null!=n[h]&&-1!=="n?".indexOf(n[h].t)){for(i=n[h].v.indexOf(".")>-1&&h===T?n[h].v.indexOf(".")-1:n[h].v.length-1,O=n[h].v.substr(i+1);i>=0;--i)C>=0&&("0"===n[h].v.charAt(i)||"#"===n[h].v.charAt(i))&&(O=S.charAt(C--)+O);n[h].v=O,n[h].t="t",A=h}for(C>=0&&A<n.length&&(n[A].v=S.substr(0,C+1)+n[A].v),C=S.indexOf(".")+1,h=T;h<n.length;++h)if(null!=n[h]&&(-1!=="n?(".indexOf(n[h].t)||h===T)){for(i=n[h].v.indexOf(".")>-1&&h===T?n[h].v.indexOf(".")+1:0,O=n[h].v.substr(0,i);i<n[h].v.length;++i)C<S.length&&(O+=S.charAt(C++));n[h].v=O,n[h].t="t",A=h}}}for(h=0;h<n.length;++h)null!=n[h]&&"n?".indexOf(n[h].t)>-1&&(x=s>1&&t<0&&h>0&&"-"===n[h-1].v?-t:t,n[h].v=F(n[h].t,n[h].v,x),n[h].t="t");var D="";for(h=0;h!==n.length;++h)null!=n[h]&&(D+=n[h].v);return D}e.is_date=M,e._eval=k;var x=/\[[=<>]/,S=/\[(=|>[=]?|<[>=]?)(-?\d+(?:\.\d*)?)\]/;function O(e,t){if(null==t)return!1;var a=parseFloat(t[2]);switch(t[1]){case"=":if(e==a)return!0;break;case">":if(e>a)return!0;break;case"<":if(e<a)return!0;break;case"<>":if(e!=a)return!0;break;case">=":if(e>=a)return!0;break;case"<=":if(e<=a)return!0}return!1}function T(e,t,a){null==a&&(a={});var s="";switch(typeof e){case"string":s="m/d/yy"==e&&a.dateNF?a.dateNF:e;break;case"number":s=14==e&&a.dateNF?a.dateNF:(null!=a.table?a.table:c)[e]}if(o(s,0))return _(t,a);t instanceof Date&&(t=b(t,a.date1904));var l=function(e,t){var a=C(e),s=a.length,l=a[s-1].indexOf("@");if(s<4&&l>-1&&--s,a.length>4)throw new Error("cannot find right format for |"+a.join("|")+"|");if("number"!=typeof t)return[4,4===a.length||l>-1?a[a.length-1]:"@"];switch(a.length){case 1:a=l>-1?["General","General","General",a[0]]:[a[0],a[0],a[0],"@"];break;case 2:a=l>-1?[a[0],a[0],a[0],a[1]]:[a[0],a[1],a[0],"@"];break;case 3:a=l>-1?[a[0],a[1],a[0],a[2]]:[a[0],a[1],a[2],"@"]}var i=t>0?a[0]:t<0?a[1]:a[2];if(-1===a[0].indexOf("[")&&-1===a[1].indexOf("["))return[s,i];if(null!=a[0].match(x)||null!=a[1].match(x)){var r=a[0].match(S),n=a[1].match(S);return O(t,r)?[s,a[0]]:O(t,n)?[s,a[1]]:[s,a[null!=r&&null!=n?2:1]]}return[s,i]}(s,t);if(o(l[1]))return _(t,a);if(!0===t)t="TRUE";else if(!1===t)t="FALSE";else if(""===t||null==t)return"";return k(l[1],t,a,l[0])}function A(e,t){if("number"!=typeof t){t=+t||-1;for(var a=0;a<392;++a)if(null!=c[a]){if(c[a]==e){t=a;break}}else t<0&&(t=a);t<0&&(t=391)}return c[t]=e,t}e.load=A,e._table=c,e.get_table=function(){return c},e.load_table=function(e){for(var t=0;392!=t;++t)void 0!==e[t]&&A(e[t],t)},e.init_table=u,e.format=T}(s),"undefined"==typeof DO_NOT_EXPORT_SSF&&(e.exports=s)},function(e,t,a){"use strict";a.r(t);var s=a(1),l=a.n(s),i=a(0);const r={theme:{section:"Theme",type:"string",display:"select",label:"Theme",values:[{Traditional:"traditional"},{Looker:"looker"},{Contemporary:"contemporary"},{"Use custom theme":"custom"}],default:"traditional",order:1},customTheme:{section:"Theme",type:"string",label:"Load custom CSS from:",default:"",order:2},layout:{section:"Theme",type:"string",display:"select",label:"Layout",values:[{Even:"fixed"},{Auto:"auto"}],default:"fixed",order:3},minWidthForIndexColumns:{section:"Theme",type:"boolean",label:"Automatic column width on index",default:!0,order:3.5},headerFontSize:{section:"Theme",type:"number",display_size:"half",label:"Header Size",default:12,order:4},bodyFontSize:{section:"Theme",type:"number",display_size:"half",label:"Body Size",default:12,order:5},showTooltip:{section:"Theme",type:"boolean",display_size:"half",label:"Show tooltip",default:!0,order:6},showHighlight:{section:"Theme",type:"boolean",display_size:"half",label:"Show highlight",default:!0,order:7},columnOrder:{},rowSubtotals:{section:"Table",type:"boolean",label:"Row Subtotals",display_size:"half",default:!1,order:1},colSubtotals:{section:"Table",type:"boolean",label:"Col Subtotals",display_size:"half",default:!1,order:2},spanRows:{section:"Table",type:"boolean",label:"Merge Dims",display_size:"half",default:!0,order:3},spanCols:{section:"Table",type:"boolean",label:"Merge Headers",display_size:"half",default:!0,order:4},calculateOthers:{section:"Table",type:"boolean",label:"Calculate Others Row",default:!0,order:4.5},sortColumnsBy:{section:"Table",type:"string",display:"select",label:"Sort Columns By",values:[{Pivots:"pivots"},{Measures:"measures"}],default:"pivots",order:6},useViewName:{section:"Table",type:"boolean",label:"Include View Name",default:!1,order:7},useHeadings:{section:"Table",type:"boolean",label:"Use Headings",default:!1,order:8},useShortName:{section:"Table",type:"boolean",label:"Use Short Name (from model tags)",default:!1,order:9},useUnit:{section:"Table",type:"boolean",label:"Use Unit (when reporting in 000s)",default:!1,order:9.5},groupVarianceColumns:{section:"Table",type:"boolean",label:"Group Variance Columns",default:!1,order:10},varianceForLastColumnPairOnly:{section:"Table",type:"boolean",label:"Show Variance columns for last column pair only",default:!1,order:10},genericLabelForSubtotals:{section:"Table",type:"boolean",label:"Label all subtotal rows as 'Subtotal'",default:!1,order:11},indexColumn:{section:"Dimensions",type:"boolean",label:"Use Last Field Only",default:!1,order:0},transposeTable:{section:"Table",type:"boolean",label:"Transpose Table",default:!1,order:100}};exports.VisPluginTableModel=class{constructor(e,t,a){this.visId="report_table",this.config=a,this.headers=[],this.dimensions=[],this.measures=[],this.columns=[],this.data=[],this.subtotals_data={},this.transposed_headers=[],this.transposed_columns=[],this.transposed_data=[],this.pivot_fields=[],this.pivot_values=void 0!==t.pivots?t.pivots:[],this.variances=[],this.column_series=[],this.firstVisibleDimension="",this.useIndexColumn=a.indexColumn||!1,this.useHeadings=a.useHeadings||!1,this.useShortName=a.useShortName||!1,this.useViewName=a.useViewName||!1,this.addRowSubtotals=a.rowSubtotals||!1,this.addSubtotalDepth=parseInt(a.subtotalDepth)||this.dimensions.length-1,this.addColSubtotals=a.colSubtotals||!1,this.spanRows=a.spanRows,this.spanCols=a.spanCols,this.sortColsBy=a.sortColumnsBy||"pivots",this.fieldLevel=0,this.groupVarianceColumns=a.groupVarianceColumns||!1,this.varianceForLastColumnPairOnly=a.varianceForLastColumnPairOnly||!1,this.minWidthForIndexColumns=a.minWidthForIndexColumns||!1,this.showTooltip=a.showTooltip||!1,this.showHighlight=a.showHighlight||!1,this.genericLabelForSubtotals=a.genericLabelForSubtotals||!1,this.hasTotals=void 0!==t.totals_data,this.calculateOthers=void 0!==t.truncated&&(t.truncated&&a.calculateOthers),this.hasSubtotals=void 0!==t.subtotals_data,this.hasRowTotals=t.has_row_totals||!1,this.hasPivots=void 0!==t.pivots,this.hasSupers=void 0!==t.fields.supermeasure_like&&Boolean(t.fields.supermeasure_like.length),this.transposeTable=a.transposeTable||!1;this.addPivotsAndHeaders(t),this.addDimensions(t,0),this.addMeasures(t,0),this.checkVarianceCalculations(),this.useIndexColumn&&this.addIndexColumn(t),this.hasSubtotals&&this.checkSubtotalsData(t),this.addRows(e),this.addColumnSeries(),this.hasTotals&&this.buildTotals(t),this.spanRows&&this.setRowSpans(),this.addRowSubtotals&&this.addSubTotals(),this.addColSubtotals&&2===this.pivot_fields.length&&this.addColumnSubTotals(),this.variances&&this.addVarianceColumns(),this.sortColumns(),this.columns.forEach(e=>e.setHeaderCellLabels()),this.spanCols&&this.setColSpans(),this.applyFormatting(),this.transposeTable&&(this.transposeDimensionsIntoHeaders(),this.transposeRowsIntoColumns(),this.transposeColumnsIntoRows()),this.validateConfig(),this.getTableColumnGroups()}static getCoreConfigOptions(){return r}getConfigOptions(){var e=r,t=[];return this.dimensions.forEach((a,s)=>{if(e["label|"+a.name]={section:"Dimensions",type:"string",label:a.label,default:a.label,order:10*s+1},e["heading|"+a.name]={section:"Dimensions",type:"string",label:"Heading",default:"",order:10*s+2},e["hide|"+a.name]={section:"Dimensions",type:"boolean",label:"Hide",display_size:"third",default:!1,order:10*s+3},s<this.dimensions.length-1){var l={};l[a.label]=(s+1).toString(),t.push(l)}}),e.subtotalDepth={section:"Table",type:"string",label:"Sub Total Depth",display:"select",values:t,default:"1",order:5},this.measures.forEach((t,a)=>{e["label|"+t.name]={section:"Measures",type:"string",label:t.label,default:t.label,order:100+10*a+1},e["heading|"+t.name]={section:"Measures",type:"string",label:"Heading for "+t.label,default:"",order:100+10*a+2},e["style|"+t.name]={section:"Measures",type:"string",label:"Style",display:"select",display_size:"third",values:[{Normal:"normal"},{"Black/Red":"black_red"},{Subtotal:"subtotal"},{Hidden:"hide"}],default:"normal",order:100+10*a+3},e["reportIn|"+t.name]={section:"Measures",type:"string",label:"Report In",display:"select",display_size:"third",values:[{"Absolute Figures":"1"},{Thousands:"1000"},{Millions:"1000000"},{Billions:"1000000000"}],default:"1",order:100+10*a+3.5},e["unit|"+t.name]={section:"Measures",type:"string",label:"Unit",display_size:"third",default:"",order:100+10*a+3.7};var s=[];if(t.can_pivot){var l=[];this.pivot_fields.forEach((e,t)=>{if(1===this.pivot_fields.length||1===t||this.config.colSubtotals){var a={};a["By "+e.label]=e.name,l.push(a)}}),s=s.concat(l)}this.measures.forEach((e,l)=>{var i=t.can_pivot===e.can_pivot||this.hasRowTotals&&!e.is_table_calculation;if(a!=l&&i){var r={};r["Vs. "+e.label]=e.name,s.push(r)}}),s.unshift({"(none)":"no_variance"}),e["comparison|"+t.name]={section:"Measures",type:"string",label:"Comparison",display:"select",values:s,default:"no_variance",order:100+10*a+5},e["switch|"+t.name]={section:"Measures",type:"boolean",label:"Switch",display_size:"third",default:!1,order:100+10*a+6},e["var_num|"+t.name]={section:"Measures",type:"boolean",label:"Var #",display_size:"third",default:!0,order:100+10*a+7},e["var_pct|"+t.name]={section:"Measures",type:"boolean",label:"Var %",display_size:"third",default:!1,order:100+10*a+8}}),e}addPivotsAndHeaders(e){e.fields.pivots.forEach((e,t)=>{var a=new i.ModelPivot({vis:this,queryResponseField:e});this.pivot_fields.push(a),this.headers.push({type:"pivot"+t,modelField:a})});var t=this.useHeadings?[{type:"heading",modelField:{label:"(will be replaced by header for column)s"}}]:[];t.push({type:"field",modelField:{label:"(will be replaced by field for column)"}}),"pivots"===this.sortColsBy?this.headers.push(...t):this.headers.unshift(...t);for(var a=0;a<this.headers.length;a++)if("field"===!this.headers[a]){this.fieldLevel=a;break}}addDimensions(e,t){e.fields.dimension_like.forEach(e=>{var a=new i.ModelDimension({vis:this,queryResponseField:e});a.hide=!!this.useIndexColumn||a.hide,this.dimensions.push(a);var s=new i.Column(a.name,this,a);s.idx=t,s.sort.push(0),this.headers.forEach(e=>{switch(e.type){case"pivot0":case"pivot1":var l=new i.ModelPivot({vis:this,queryResponseField:e.modelField}),r=new i.HeaderCell({column:s,type:e.type,modelField:l});r.label="",s.levels.push(r),s.sort.push(0);break;case"heading":s.levels.push(new i.HeaderCell({column:s,type:"heading",modelField:a}));break;case"field":s.levels.push(new i.HeaderCell({column:s,type:"field",modelField:a})),s.sort.push(t)}}),this.columns.push(s),t+=10});for(var a=0;a<this.dimensions.length;a++){var s=this.dimensions[a];if(!s.hide){this.firstVisibleDimension=s.name;break}}}addMeasures(e,t){e.fields.measure_like.forEach(e=>{var t=new i.ModelMeasure({vis:this,queryResponseField:e,can_pivot:!0}),a=this.config["reportIn|"+e.name],s=this.config["unit|"+e.name];void 0!==a&&"1"!==a&&(t.value_format="#,##0",void 0!==s&&""!==s&&(t.unit=s)),this.measures.push(t)}),this.hasPivots?this.pivot_values.forEach(e=>{var a="$$$_row_total_$$$"===e.key;this.measures.forEach((s,l)=>{if(!a||a&&!s.is_table_calculation){var r=new i.Column([e.key,s.name].join("."),this,s);r.pivoted=!a,r.isRowTotal=a,r.pivot_key=e.key,r.idx=t,r.sort.push(a?2:1);var n=[];this.headers.forEach(t=>{switch(t.type){case"pivot0":case"pivot1":var o=a?"":e.data[t.modelField.name];a&&t.type.startsWith("pivot")&&t.type==="pivot"+(this.pivot_fields.length-1)&&(o="Row Total"),r.levels.push(new i.HeaderCell({column:r,type:t.type,modelField:{label:o},pivotData:e})),n.push(e.sort_values[t.modelField.name]),r.pivoted?r.sort.push(e.sort_values[t.modelField.name]):r.sort.push(0);break;case"heading":r.levels.push(new i.HeaderCell({column:r,type:"heading",modelField:s}));break;case"field":r.levels.push(new i.HeaderCell({column:r,type:"field",modelField:s})),r.sort.push(l)}}),this.columns.push(r),t+=10}})}):this.measures.forEach(e=>{var a=new i.Column(e.name,this,e);a.sort.push(1),a.idx=t;try{void 0!==this.config.columnOrder[a.id]?a.pos=this.config.columnOrder[a.id]:a.pos=t}catch{a.pos=t}this.headers.forEach(t=>{switch(t.type){case"heading":a.levels.push(new i.HeaderCell({column:a,type:"heading",modelField:e}));break;case"field":a.levels.push(new i.HeaderCell({column:a,type:"field",modelField:e})),a.sort.push(a.pos)}}),this.columns.push(a),t+=10}),void 0!==e.fields.supermeasure_like&&e.fields.supermeasure_like.forEach(e=>{var a=new i.ModelMeasure({vis:this,queryResponseField:e,can_pivot:!1}),s=this.config["reportIn|"+e.name],l=this.config["unit|"+e.name];void 0!==s&&"1"!==s&&(a.value_format="#,##0",void 0!==l&&""!==l&&(a.unit=l)),this.measures.push(a);var r=new i.Column(a.name,this,a);r.sort.push(2),this.headers.forEach(e=>{switch(e.type){case"pivot0":case"pivot1":r.levels.push(new i.HeaderCell({column:r,type:e.type,modelField:{label:""}})),r.sort.push(1);break;case"heading":r.levels.push(new i.HeaderCell({column:r,type:"heading",modelField:a}));break;case"field":r.levels.push(new i.HeaderCell({column:r,type:"field",modelField:a})),r.sort.push(t)}}),r.idx=t,r.super=!0,this.columns.push(r),t+=10})}checkVarianceCalculations(){Object.keys(this.config).forEach(e=>{if(e.startsWith("comparison")){var t=e.split("|")[1],a=this.config[e],s=!1;this.measures.forEach(e=>{t===e.name&&(s=!0)});var l=!1;if([...this.measures.map(e=>e.name),...this.pivot_fields.map(e=>e.name)].forEach(e=>{a===e&&(l=!0)}),s&&l){if(this.pivot_fields.map(e=>e.name).includes(this.config[e]))var i="by_pivot";else i="no_variance"===this.config[e]?"no_variance":"vs_measure";if(void 0!==this.config["switch|"+t])if(this.config["switch|"+t])var r=!0;else r=!1;this.variances.push({baseline:t,comparison:this.config[e],type:i,reverse:r})}else s?this.config[e]="no_variance":delete this.config[e]}})}addIndexColumn(){var e=this.dimensions[this.dimensions.length-1],t=this.config["hide|"+e.name],a=new i.Column("$$$_index_$$$",this,e);a.sort.push(-1),a.hide=!0===t&&t,this.headers.forEach(t=>{switch(t.type){case"pivot0":case"pivot1":var s=new i.ModelPivot({vis:this,queryResponseField:t.modelField}),l=new i.HeaderCell({column:a,type:t.type,modelField:s});l.label="",a.levels.push(l),a.sort.push(0);break;case"heading":a.levels.push(new i.HeaderCell({column:a,type:"heading",modelField:e}));break;case"field":a.levels.push(new i.HeaderCell({column:a,type:"field",modelField:e})),a.sort.push(0)}}),this.columns.push(a)}checkSubtotalsData(e){void 0!==e.subtotals_data[this.addSubtotalDepth]&&e.subtotals_data[this.addSubtotalDepth].forEach(e=>{var t=new i.Row("subtotal");t.$$$__grouping__$$$=e.$$$__grouping__$$$;var a=["Subtotal"];t.$$$__grouping__$$$.forEach(t=>{a.push(e[t].value)}),t.id=a.join("|"),this.columns.forEach(a=>{t.data[a.id]=a.pivoted||a.isRowTotal?e[a.modelField.name][a.pivot_key]:e[a.id];var s=t.data[a.id];if(void 0!==s){void 0===s.cell_style?s.cell_style=["total","subtotal"]:s.cell_style=s.cell_style.concat(["total","subtotal"]),void 0!==a.modelField.style&&(s.cell_style=s.cell_style.concat(a.modelField.style)),null===s.value&&(s.rendered="");var i=this.config["reportIn|"+a.modelField.name];if(void 0!==i&&"1"!==i){var r=this.config.useUnit&&"#"!==a.modelField.unit?a.modelField.unit:"";s.html=null,s.value=Math.round(s.value/parseInt(i)),s.rendered=""===a.modelField.value_format?s.value.toString():r+l.a.format(a.modelField.value_format,s.value)}}}),this.subtotals_data[t.id]=t})}addRows(e){e.forEach((e,t)=>{var a=new i.Row("line_item");if(a.id=this.dimensions.map(t=>e[t.name].value).join("|"),this.columns.forEach(t=>{var s=t.pivoted||t.isRowTotal?e[t.modelField.name][t.pivot_key]:e[t.id],r=new i.DataCell({...s,cell_style:[t.modelField.type],colid:t.id,rowid:a.id});t.modelField.is_numeric?(r.cell_style.push("numeric"),r.align="right"):(r.cell_style.push("nonNumeric"),r.align="left"),void 0!==t.modelField.style&&(r.cell_style=r.cell_style.concat(t.modelField.style));var n=this.config["reportIn|"+t.modelField.name];if(void 0!==n&&"1"!==n){var o=this.config.useUnit&&"#"!==t.modelField.unit?t.modelField.unit:"";r.html=null,r.value=Math.round(r.value/parseInt(n)),r.rendered=""===t.modelField.value_format?r.value.toString():o+l.a.format(t.modelField.value_format,r.value)}if(t.modelField.is_turtle){var d=new i.CellSeries({column:t,row:a,sort_value:r.sort_value,series:{keys:a.data[t.id]._parsed.keys,values:a.data[t.id]._parsed.values}});r.value=d,r.rendered=d.toString()}a.data[t.id]=r}),this.useIndexColumn){var s=this.dimensions[this.dimensions.length-1].name,r=a.data[s];a.data.$$$_index_$$$=new i.DataCell({value:r.value,rendered:r.rendered,html:r.html,cell_style:["singleIndex","dimension"],align:this.dimensions[this.dimensions.length-1].is_numeric?"right":"left",colid:"$$$_index_$$$",rowid:r.rowid})}a.sort=[0,0,t],this.data.push(a)})}addColumnSeries(){this.columns.forEach(e=>{var t=[],a=[],s=[];this.data.forEach(l=>{t.push(l.id),a.push(l.data[e.id].value),s.push(l.type)});var l=new i.ColumnSeries({column:e,is_numeric:e.modelField.is_numeric,series:{keys:t,values:a,types:s}});e.series=l,this.column_series.push(l)})}buildTotals(e){var t=e.totals_data,a=new i.Row("total");if(this.columns.forEach(e=>{if(a.id="Total","dimension"===e.modelField.type){if([this.firstVisibleDimension,"$$$_index_$$$"].includes(e.id))var s=1,r=this.useIndexColumn?1:this.dimensions.filter(e=>!e.hide).length;else s=-1,r=-1;a.data[e.id]=new i.DataCell({value:"",cell_style:["total","dimension"],rowspan:s,colspan:r,colid:e.id,align:e.modelField.is_numeric?"right":"left",rowid:"Total"})}else s=1,r=1;if("measure"===e.modelField.type){var n=e.modelField.is_numeric?["total","numeric","measure"]:["total","nonNumeric","measure"],o=e.pivoted||e.isRowTotal?t[e.modelField.name][e.pivot_key]:t[e.id];void 0===(o=new i.DataCell({...o,cell_style:n,rowspan:s,colspan:r,colid:e.id,align:e.modelField.is_numeric?"right":"left",rowid:"Total"})).rendered&&void 0!==o.html&&(o.rendered=this.getRenderedFromHtml(o));var d=this.config["reportIn|"+e.modelField.name];if(void 0!==d&&"1"!==d){var h=this.config.useUnit&&"#"!==e.modelField.unit?e.modelField.unit:"";o.html=void 0,o.value=Math.round(o.value/parseInt(d)),o.rendered=""===e.modelField.value_format?o.value.toString():h+l.a.format(e.modelField.value_format,o.value)}a.data[e.id]=o,void 0!==a.data[e.id].links&&a.data[e.id].links.forEach(e=>{e.type="measure_default"})}}),this.useIndexColumn?(a.data.$$$_index_$$$.value="TOTAL",a.data.$$$_index_$$$.align="left",a.data.$$$_index_$$$.colspan=this.dimensions.filter(e=>!e.hide).length):this.firstVisibleDimension&&(a.data[this.firstVisibleDimension].value="TOTAL",a.data[this.firstVisibleDimension].align="left"),a.sort=[1,0,0],this.data.push(a),this.calculateOthers){var s=new i.Row("line_item");s.id="Others",this.columns.forEach(e=>{var t=null,r=e.modelField.is_numeric?["numeric"]:["nonNumeric"],n=a.data[e.id];if("measure"===e.modelField.type?(t=["sum","count"].includes(e.modelField.calculation_type))?(t=n.value-e.series.series.sum,r.push("measure")):(t=(n.value+e.series.series.avg)/2,r=r.concat(["estimate","measure"]),["count","count_distinct"].includes(e.modelField.calculation_type)&&(t=Math.round(t))):r.push("dimension"),t){var o=""===e.modelField.value_format?t.toString():l.a.format(e.modelField.value_format,t);s.data[e.id]=new i.DataCell({value:t,rendered:o,cell_style:r,align:e.modelField.is_numeric?"right":"left",colid:e.id,rowid:"Others"})}else s.data[e.id]=new i.DataCell({rendered:"",cell_style:r,colid:e.id,rowid:"Others"})}),this.useIndexColumn?(s.data.$$$_index_$$$.value="Others",s.data.$$$_index_$$$.rendered="Others",s.data.$$$_index_$$$.align="left",s.data.$$$_index_$$$.cell_style.push("singleIndex")):this.firstVisibleDimension&&(s.data[this.firstVisibleDimension].value="Others",s.data[this.firstVisibleDimension].rendered="Others",s.data[this.firstVisibleDimension].align="left"),s.sort=[1,-1,-1],this.data.push(s)}this.sortData()}setRowSpans(){var e,t=[],a={};e=this.data,(t=this.dimensions.filter(e=>!e.hide)).forEach(e=>{a[e.name]=1});for(var s=e.length-1;s>=0;s--){var l=e[s];if("line_item"===l.type)for(var i=0;i<t.length;i++){var r=t[i],n=l.data[r.name].value,o=s>0?e[s-1].data[r.name].value:null;if(!(s>0&&n===o)){for(var d=i;d<t.length;d++){var h=t[d];l.data[h.name].rowspan=a[h.name],l.data[h.name].rowspan>1&&l.data[h.name].cell_style.push("merged"),a[h.name]=1}break}l.data[r.name].rowspan=-1,l.data[r.name].colspan=-1,a[r.name]+=1}else t.forEach(e=>{a[e.name]=1})}}addSubTotals(){var e=this.addSubtotalDepth,t=[],a=[];this.data.forEach((s,l)=>{if("total"!==s.type){for(var i=[],r=0;r<e;r++){var n=this.dimensions[r].name;i.push(s.data[n].value)}i.join("|")!==a.join("|")&&(t.push(i),a=i),s.sort=[0,t.length-1,l]}"Others"===s.id&&"line_item"===s.type&&(s.hide=!0)}),t.forEach((e,t)=>{var a=new i.Row("subtotal"),s=e.join("|")?e.join("|"):"Others";a.id=["Subtotal",s].join("|"),this.columns.forEach(s=>{if("dimension"===s.modelField.type){if([this.firstVisibleDimension,"$$$_index_$$$"].includes(s.id))var r=1,n=this.useIndexColumn?1:this.dimensions.filter(e=>!e.hide).length;else r=-1,n=-1;var o=s.modelField.is_numeric?["total","subtotal","numeric","dimension"]:["total","subtotal","nonNumeric","dimension"],d=new i.DataCell({cell_style:o,align:s.modelField.is_numeric?"right":"left",rowspan:r,colspan:n,colid:s.id,rowid:a.id});"$$$_index_$$$"!==s.id&&s.id!==this.firstVisibleDimension||(this.genericLabelForSubtotals?(d.value="Subtotal",d.rendered="Subtotal"):(d.value=e.join(" | ")?e.join(" | "):"Others",d.rendered=d.value)),a.data[s.id]=d}if("measure"==s.modelField.type){o=s.modelField.is_numeric?["total","subtotal","numeric","measure"]:["total","subtotal","nonNumeric","measure"];var h=s.modelField.is_numeric?"right":"left";if(Object.entries(this.subtotals_data).length>0&&!a.id.startsWith("Subtotal|Others")){d=new i.DataCell({...a.data[s.id],...this.subtotals_data[a.id].data[s.id],cell_style:o,align:h,colid:s.id,rowid:a.id});a.data[s.id]=d}else{var u=0,c=0,m="";if(this.data.forEach(e=>{if("line_item"==e.type&&e.sort[1]==t){var a=e.data[s.id].value;Number.isFinite(a)&&(u+=a,c++)}}),"average"===s.modelField.calculation_type&&c>0&&(u/=c),u){var p=this.config.useUnit&&"#"!==s.modelField.unit?s.modelField.unit:"";m=""===s.modelField.value_format?u.toString():p+l.a.format(s.modelField.value_format,u)}"string"===s.modelField.calculation_type&&(u="",m="");d=new i.DataCell({value:u,rendered:m,cell_style:o,align:h,colid:s.id,rowid:a.id});a.data[s.id]=d}}}),a.sort=[0,t,9999],this.data.push(a)}),this.sortData(),this.hasSubtotals=!0}addColumnSubTotals(){var e=[],t=[],a=this.pivot_fields[0].name;this.pivot_values.forEach(e=>{var s=e.data[a];null!==s&&t.push(s)}),(t=[...new Set(t)]).forEach(t=>{this.measures.forEach((a,s)=>{if(a.can_pivot){var l=new i.Column(["$$$_subtotal_$$$",t,a.name].join("."),this,a);l.pivoted=!0,l.subtotal=!0,l.pivot_key=[t,"$$$_subtotal_$$$"].join("|"),l.subtotal_data={pivot:t,measure_idx:s,columns:[]},this.columns.forEach((e,s)=>{var i=null;for(s=0;s<e.levels.length;s++)if(e.levels[s].type.startsWith("pivot")){i=e.levels[s].modelField.label;break}e.pivoted&&i===t&&e.modelField.name===a.name&&l.subtotal_data.columns.push(e)}),e.push(l)}})}),e.forEach((e,t)=>{e.sort.push(1),this.headers.forEach((t,a)=>{switch(t.type){case"pivot0":var s=e.subtotal_data.columns[0].levels[a].pivotData.sort_values[t.modelField.name];e.levels.push(new i.HeaderCell({column:e,type:t.type,modelField:{name:this.pivot_fields[0].name,label:e.subtotal_data.pivot}})),e.sort.push(s);break;case"pivot1":e.levels.push(new i.HeaderCell({column:e,type:t.type,modelField:{name:"subtotal",label:"Subtotal"}}));var l="string"==typeof this.pivot_values[0].sort_values[t.modelField.name]?"ZZZZ":99999999;e.sort.push(l);break;case"heading":e.levels.push(new i.HeaderCell({column:e,type:"heading",modelField:e.modelField}));break;case"field":e.levels.push(new i.HeaderCell({column:e,type:"field",modelField:e.modelField})),e.sort.push(e.subtotal_data.measure_idx)}}),this.columns.push(e)}),this.data.forEach(t=>{e.forEach(e=>{var a=e.modelField.is_numeric?["subtotal","numeric","measure"]:["subtotal","nonNumeric","measure"],s=0;e.subtotal_data.columns.forEach(e=>{s+=t.data[e.id].value}),t.data[e.id]=new i.DataCell({value:s,rendered:""===e.modelField.value_format?s.toString():l.a.format(e.modelField.value_format,s),cell_style:a,colid:e.id,rowid:t.id}),["subtotal","total"].includes(t.type)&&t.data[e.id].cell_style.push("total")})})}calculateVariance(e,t,a,s,r){this.data.forEach(n=>{var o=n.data[s.id].value,d=n.data[r.id].value;if("absolute"===a)var h=new i.DataCell({value:o-d,rendered:""===e?(o-d).toString():l.a.format(e,o-d),cell_style:["numeric","measure","variance","varianceAbsolute"],colid:t,rowid:n.id});else{var u=(o-d)/Math.abs(d);if(isFinite(u))h=new i.DataCell({value:u,rendered:l.a.format("#0.00%",u),cell_style:["numeric","measure","variance","variancePercent"],colid:t,rowid:n.id});else var h=new i.DataCell({value:null,rendered:"∞",cell_style:["numeric","measure","variance","variancePercent"],colid:t,rowid:n.id})}"total"!=n.type&&"subtotal"!=n.type||h.cell_style.push("total"),"subtotal"===n.type&&h.cell_style.push("subtotal"),h.value<0&&h.cell_style.push("negative"),n.data[t]=h})}createVarianceColumn(e){if(this.config.colSubtotals||!e.variance.baseline.startsWith("$$$_subtotal_$$$")){var t=["$$$_variance_$$$",e.calc,e.variance.baseline,e.variance.comparison].join("|"),a=this.getColumnById(e.variance.baseline),s=this.getColumnById(e.variance.comparison),l=new i.Column(t,this,a.modelField);l.isVariance=!0,"absolute"===e.calc?(l.variance_type="absolute",l.idx=a.idx+1,l.pos=a.pos+1,l.sort=[...a.sort,1],l.hide=!this.config["var_num|"+a.modelField.name]):(l.variance_type="percentage",l.idx=a.idx+2,l.pos=a.pos+2,l.sort=[...a.sort,2],l.unit="%",l.hide=!this.config["var_pct|"+a.modelField.name]),void 0!==this.config.columnOrder[l.id]&&(l.pos=this.config.columnOrder[l.id]),l.pivoted=a.pivoted,l.super=a.super,l.pivot_key=a.pivot_key,this.groupVarianceColumns&&(l.sort[0]=1.5),this.headers.forEach((e,t)=>{switch(e.type){case"pivot0":case"pivot1":var s=a.getHeaderCellLabelByType(e.type);if(this.groupVarianceColumns&&"pivot0"===e.type)s=2===this.pivot_values.length?"Variance":"Variance: "+s;var r=new i.HeaderCell({column:l,type:e.type,modelField:{label:s}});l.levels[t]=r;break;case"heading":r=new i.HeaderCell({column:l,type:"heading",modelField:a.modelField});l.levels[t]=r;break;case"field":r=new i.HeaderCell({column:l,type:"field",modelField:a.modelField});l.levels[t]=r}}),this.columns.push(l),e.variance.reverse?this.calculateVariance(a.modelField.value_format,t,e.calc,s,a):this.calculateVariance(a.modelField.value_format,t,e.calc,a,s)}else console.log("Cannot calculate variance of column subtotals if subtotals disabled.")}addVarianceColumns(){var e=[],t=["absolute","percent"];Object.keys(this.variances).forEach(a=>{var s=this.variances[a];if("no_variance"!==s.comparison)if("vs_measure"===s.type)this.hasPivots?(this.varianceForLastColumnPairOnly?this.pivot_values.slice(-1):this.pivot_values).forEach(a=>{a.is_total||t.forEach(t=>{e.push({calc:t,variance:{baseline:[a.key,s.baseline].join("."),comparison:[a.key,s.comparison].join("."),reverse:s.reverse,type:s.type}})})}):t.forEach(t=>{e.push({variance:s,calc:t})});else if("by_pivot"===s.type)if(1===this.pivot_fields.length||this.pivot_fields[1].name===s.comparison){(this.varianceForLastColumnPairOnly?this.pivot_values.slice(-1):this.pivot_values.slice(1)).forEach((a,l)=>{t.forEach(t=>{a.is_total||e.push({calc:t,variance:{baseline:[a.key,s.baseline].join("."),comparison:[this.pivot_values[l].key,s.baseline].join("."),reverse:s.reverse,type:s.type}})})})}else{var l=[];this.pivot_values.forEach(e=>{if(!e.is_total){var t=e.data[this.pivot_fields[0].name];l.includes(t)||l.push(t)}}),l.slice(1).forEach((a,i)=>{t.forEach(t=>{e.push({calc:t,variance:{baseline:["$$$_subtotal_$$$",a,s.baseline].join("."),comparison:["$$$_subtotal_$$$",l[i],s.baseline].join("."),reverse:s.reverse,type:s.type}})})})}}),e.forEach(e=>{this.createVarianceColumn(e)})}compareSortArrays(e,t){for(var a=Math.max(e.sort.length,t.sort.length),s=0;s<a;s++){var l=void 0!==e.sort[s]?e.sort[s]:0,i=void 0!==t.sort[s]?t.sort[s]:0;if(l>i)return 1;if(l<i)return-1}return-1}sortData(){this.data.sort(this.compareSortArrays),this.spanRows&&this.setRowSpans()}sortColumns(){this.columns.sort(this.compareSortArrays)}setColSpans(){var e=[],t=[],a={};this.columns.filter(e=>!e.hide).forEach(t=>{var a={id:t.id,data:t.getHeaderData()};e.push(a)}),(t=this.headers).forEach(e=>{a[e.type]=1});for(var s=e.length-1;s>=0;s--)for(var l=e[s],i=0;i<t.length;i++){var r=t[i],n=l.data[r.type].label,o=s>0?e[s-1].data[r.type].label:null;if(!(s>0&&n===o)){for(var d=i;d<t.length;d++){var h=t[d];l.data[h.type].colspan=a[h.type],l.data[h.type].colspan>1&&(l.data[h.type].align="center",l.data[h.type].cell_style.push("merged")),a[h.type]=1}break}l.data[r.type].colspan=-1,l.data[r.type].rowspan=-1,a[r.type]+=1}}applyFormatting(){this.columns.forEach(e=>{var t=this.config["style|"+e.modelField.name];if(void 0!==t)switch(t){case"black_red":this.data.forEach(t=>{t.data[e.id].value<0&&t.data[e.id].cell_style.push("negative")})}})}transposeDimensionsIntoHeaders(){this.transposed_headers=this.columns.filter(e=>"dimension"===e.modelField.type).filter(e=>!e.hide).map(e=>({type:"field",modelField:e.modelField}))}transposeRowsIntoColumns(){var e={align:"left",type:"transposed_table_index",is_table_calculation:!1};this.headers.forEach((t,a)=>{var s=new i.Column(t.type,this,e);this.transposed_headers.forEach((e,t)=>{var l=this.columns[t].levels[a],r=new i.HeaderCell({column:s,type:l.type,label:l.label,cell_style:l.cell_style,align:l.align,modelField:l.modelField});r.rowspan=l.colspan,r.colspan=l.rowspan,r.id=[l.modelField.name,l.type].join("."),r.cell_style.push("transposed"),r.colspan>0&&r.cell_style.push("merged"),s.levels.push(r)}),this.transposed_columns.push(s)});var t={align:"right",type:"transposed_table_measure",is_table_calculation:!1};this.data.forEach(e=>{var a=new i.Column(e.id,this,t);this.transposed_headers.forEach(t=>{var s=this.useIndexColumn&&["subtotal","total"].includes(e.type)?"$$$_index_$$$":t.modelField.name,l=e.data[s],r=new i.HeaderCell({column:a,type:t.type,label:""===l.rendered?l.rendered:l.rendered||l.value,align:"center",cell_style:l.cell_style});r.colspan=l.rowspan,r.rowspan=l.colspan,r.id=[l.colid,l.rowid].join("."),r.cell_style.push("transposed"),a.levels.push(r)}),this.transposed_columns.push(a)})}transposeColumnsIntoRows(){console.log("transposeColumnsIntoRows()..."),this.columns.filter(e=>"measure"===e.modelField.type).forEach(e=>{var t={};e.levels.forEach((a,s)=>{var l=new i.DataCell({value:a.label,rendered:a.label,rowspan:a.colspan,colspan:a.rowspan,cell_style:["indexCell","transposed"],align:"left",colid:e.id,rowid:a.type});switch(a.type){case"pivot0":case"pivot1":l.cell_style.push("pivot");break;case"heading":case"field":var r=e.modelField.is_table_calculation?"calculation":"measure";l.cell_style.push(r)}l.rowspan>1&&l.cell_style.push("merged"),t[a.type]=l}),this.data.forEach(a=>{if(void 0!==a.data[e.id]){var s=a.data[e.id];t[a.id]=a.data[e.id],t[a.id].id=[s.colid,s.rowid].join("."),t[a.id].cell_style.push("transposed")}else console.log("row data does not exist for",e.id)});var a=new i.Row("line_item");a.id=e.id,a.modelField=e.modelField,a.hide=e.hide,a.data=t,this.transposed_data.push(a)})}validateConfig(){["traditional","looker","contemporary","custom"].includes(this.config.theme)||(this.config.theme="traditional"),["fixed","auto"].includes(this.config.layout)||(this.config.layout="fixed"),void 0===this.config.transposeTable&&(this.config.transposeTable=!1),Object.entries(this.config).forEach(e=>{if("false"===e[1]?e[1]=!1:"true"===e[1]&&(e[1]=!0),2===e[0].split("|").length){var[t,a]=e[0].split("|");if(["label","heading","hide","style","switch","var_num","var_pct","comparison"].includes(t)){var s=!1;this.dimensions.forEach(e=>{e.name===a&&(s=!0)}),this.measures.forEach(e=>{e.name===a&&(s=!0)}),s||delete this.config[e[0]]}}})}getColumnById(e){var t={};return this.columns.forEach(a=>{e===a.id&&(t=a)}),t}getRowById(e){var t={};return this.data.forEach(a=>{e===a.id&&(t=a)}),t}getMeasureByName(e){var t="";return this.measures.forEach(a=>{e===a.name&&(t=a)}),t}getRenderedFromHtml(e){var t=new DOMParser;if(void 0===e.html||["undefined",""].includes(e.html))a=e.value;else try{var a=t.parseFromString(e.html,"text/html").documentElement.textContent}catch(t){var a=e.html}return a}getHeaderTiers(){return this.transposeTable?this.transposed_headers:this.headers}getTableHeaderCells(e){return this.transposeTable?this.transposed_columns.filter(t=>t.levels[e].colspan>0):this.columns.filter(e=>!e.hide).filter(t=>t.levels[e].colspan>0)}getDataRows(){if(this.transposeTable)e=this.transposed_data.filter(e=>!e.hide);else var e=this.data.filter(e=>!e.hide);return e}getTableRowColumns(e){if(this.transposeTable)t=this.transposed_columns.filter(e=>!e.hide).filter(t=>e.data[t.id].rowspan>0);else var t=this.columns.filter(e=>!e.hide).filter(t=>e.data[t.id].rowspan>0);return t}moveColumns(e,t,a){var s=this.config;if(e!=t){var l=t-e,i=s.columnOrder;this.columns.forEach(a=>{"measure"!=a.modelField.type||a.super||(a.pos>=e&&a.pos<e+10?a.pos+=l:a.pos>=t&&a.pos<e?a.pos+=10:a.pos>=e+10&&a.pos<t+10&&(a.pos-=10),i[a.id]=a.pos)}),a(i)}}getSimpleJson(){var e=[];return this.data.forEach(t=>{if("line_item"===t.type){var a={};this.columns.forEach(e=>{a[e.id]=t.data[e.id].value}),e.push(a)}}),e}getTableColumnGroups(){var e=[],t=[],a=[];this.transposeTable?this.transposed_columns.forEach(s=>{"transposed_table_index"===s.modelField.type?e.push({id:s.id,type:"index"}):"transposed_table_measure"===s.modelField.type&&"Total"!==s.id?t.push({id:s.id,type:"dataCell"}):"transposed_table_measure"===s.modelField.type&&"Total"===s.id&&a.push({id:s.id,type:"dataCell"})}):this.columns.forEach(s=>{"dimension"!==s.modelField.type||s.hide?"measure"!==s.modelField.type||s.isRowTotal||s.super||s.hide?"measure"!==s.modelField.type||!s.isRowTotal&&!s.super||s.hide||a.push({id:s.id,type:"dataCell"}):t.push({id:s.id,type:"dataCell"}):e.push({id:s.id,type:"index"})});var s=[];return e.length>0&&s.push(e),t.length>0&&s.push(t),a.length>0&&s.push(a),s}getCellToolTip(e,t){var a="<table><tbody>",s=this.getRowById(e),l=this.getColumnById(t),i=l.modelField;if("total"===s.type)a+=['<tr class="',n="focus",'"><td><span style="float:left"><em>',r="TOTAL",':</em></td><td></span><span style="float:left"> ',d="","</span></td></tr>"].join("");else if(s.id.startsWith("Others")){a+=['<tr class="',n="focus",'"><td><span style="float:left"><em>',r="Others",':</em></td><td></span><span style="float:left"> ',d="","</span></td></tr>"].join("")}else if("subtotal"===s.type){var r="SUBTOTAL",n="focus",o=this.columns.filter(e=>!e.hide).filter(e=>"dimension"===e.modelField.type)[0],d=s.data[o.id].render||s.data[o.id].value;a+=['<tr class="',n,'"><td><span style="float:left"><em>',r,':</em></td><td></span><span style="float:left"> ',d,"</span></td></tr>"].join("")}else{this.columns.filter(e=>"$$$_index_$$$"!==e.id).filter(e=>"dimension"===e.modelField.type).forEach(e=>{var t=e.getHeaderCellLabelByType("field"),i=s.data[e.id].rendered||s.data[e.id].value,r=e.id===l.id?"focus":"";a+=['<tr class="',r,'"><td><span style="float:left"><em>',t,':</em></td><td></span><span style="float:left"> ',i,"</span></td></tr>"].join("")})}a+='<tr style="height:10px"></tr>';var h=!1,u="";this.columns.filter(e=>"measure"===e.modelField.type).filter(e=>e.modelField===i).forEach(e=>{if(e.isVariance||(u=e.getHeaderCellLabelByType("field")),!e.pivoted&&!e.isRowTotal||e.pivot_key===l.pivot_key){var t=e.getHeaderCellLabelByType("field"),i=e.id===l.id?"focus":"",r=s.data[e.id],n=r.rendered||r.value;if(r.html)n=(new DOMParser).parseFromString(r.html,"text/html").documentElement.textContent;r.cell_style.includes("estimate")&&(h=!0),a+=['<tr class="',i,'"><td><span style="float:left"><em>',t,':</em></td><td></span><span style="float:right"> ',n,"</span></td></tr>"].join("")}});var c=null,m=this.config["reportIn|"+l.modelField.name];return void 0!==m&&"1"!==m&&(c=u+" reported in "+{1e3:"000s",1e6:"Millions",1e9:"Billions"}[m]),(c||h)&&(a+='<tr style="height:10px"></tr>'),c&&(a+='<tr><td colspan=2><span style="color:darkgrey">'+c+".</span></td></tr>"),h&&(a+='<tr><td colspan=2><span style="color:red">Estimated figure due to query exceeding row limit.</span></td></tr>',a+='<tr><td colspan=2><span style="color:red">Consider increasing the row limit or using an alternative measure.</span></td></tr>'),a+="</tbody><table>"}}}]);
//# sourceMappingURL=vis_table_plugin.js.map